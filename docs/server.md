# Переезд на серверную работу 

## Проекты 
+ Добавление проекта 

## Проект 
+ Добавление пайплайна в урок 
+ При добавлении новой версии пайплайна в урок новый прогон переиспользует результаты неизменённых шагов до первого несовпадения `step_version_id`; начиная с первого изменённого шага выполняется новый расчёт
+ Скачивание всего проекта (PDF / MD / DOCX)
+ Проектная версия пайплайна 
+ Обновление статуса прогонов 
+ Статус загрузки урока
+ Расчёт длительности аудио после нормализации через `ffprobe` с сохранением в `lesson.settings.audio_duration_seconds` и отображением `HH:MM` на карточке урока
+ Добавление урока загрузкой аудиофайла (drag&drop / выбор файла) с последующей нормализацией в MP3 в очереди `downloads`
+ Для модала загрузки аудио polling списка уроков приостанавливается на время `livewire`-upload (`start`) и возобновляется после `finish/error/cancel`
+ Для ошибки `livewire`-загрузки в модале добавлено toast-уведомление с рекомендацией обновить страницу
+ На странице проекта добавлен выбор сортировки уроков (`по дате добавления` / `по названию`) с сохранением в `project.settings.lessons_sort`
+ Во время открытого dropdown сортировки polling списка уроков временно приостанавливается, чтобы popover не закрывался из-за фонового ререндера
+ Для сортировки уроков по названию в PostgreSQL используется ICU-коллация `numeric` (`und-u-kn-true`), что даёт natural sorting для числовых суффиксов в названиях

## Прогон 
+ Перезапуск с текущего шага
+ Start, Stop, ExtremeStop 
+ Обновление статусов шагов и прогона в целом
+ Обновление результатов по мере обработки
+ Экспорт выбранного шага в PDF / MD / DOCX
+ PDF-экспорт переведён на `barryvdh/laravel-dompdf` (генерация из HTML/CSS)
+ Шаблон PDF вынесен в Blade: `resources/views/pdf/pipeline-step.blade.php` (`Pdf::loadView`)
+ Исправлен runtime-конфликт Alpine (`isActionsMenuOpen`) на странице прогона при переходах через `wire:navigate` и фоновых polling-запросах

## Pipeline 
+ Список 
+ Добавить пайплайн
+ Редактировать название и описание 
+ Переключить на версию 
+ Добавить шаг
+ Редактировать шаг
+ Удалить шаг 
+ Архивировать версию

## Очередь 
+ Виджет задач 
+ Механизм обновления 

## Downloader
+ В `config/downloader.php` добавлена опциональная настройка прокси `proxy` (`YT_PROXY` в `.env`)
+ Если `YT_PROXY` задан, сервис скачивания добавляет `--proxy` в параметры `yt-dlp`; по умолчанию прокси не используется

## Доступ в web-layer
+ Упрощённая token-auth для единственного пользователя `team@local`
+ Invite endpoint `/invite/{token}`: выставляет постоянный cookie и редиректит на главную
+ Проверка cookie-токена выполняется отдельным middleware; при ошибке показывается страница `Доступ закрыт`
+ Консольные команды для Forge: `auth:generate-invite` (ротирует токен) и `auth:show-invite` (показывает текущий токен без ротации)
